<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Angular Size Demo | AstroEd</title>
  <link rel="icon" type="image/svg+xml" href="../_assets/favicon.svg">
  <link rel="stylesheet" href="../_assets/astro-theme.css">
  <link rel="stylesheet" href="../_assets/demo-shell.css">
  <link rel="stylesheet" href="../_assets/demo-legacy.css">
  <link rel="stylesheet" href="./angular-size.css">
  <style>
    .model-note {
      margin-top: var(--space-md);
      background: rgba(18, 18, 31, 0.9);
      border: 1px solid var(--border-color);
      border-left: 3px solid var(--accent-gold);
      padding: 0.75rem 1rem;
      border-radius: 0 8px 8px 0;
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }

    .model-note strong {
      color: var(--text-primary);
    }
  </style>
</head>
<body>
  <div class="demo-wrapper">
    <canvas id="starfield"></canvas>

    <div class="demo-content">
      <header class="demo-header">
        <h1 class="demo-title">Angular Size</h1>
        <p class="demo-subtitle">Why things look big or small depends on size <em>and</em> distance</p>
        <button class="astro-btn secondary" id="btn-reset-defaults" type="button">Reset to Lecture Defaults</button>
      </header>

      <!-- Main Visualization -->
      <div class="viz-panel">
        <svg id="angular-size-svg" viewBox="0 0 800 300" preserveAspectRatio="xMidYMid meet">
          <!-- Background elements -->
          <defs>
            <!-- Glow filter for objects -->
            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="4" result="blur"/>
              <feMerge>
                <feMergeNode in="blur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>

            <!-- Sun gradient -->
            <radialGradient id="sunGradient">
              <stop offset="0%" stop-color="#fff5cc"/>
              <stop offset="70%" stop-color="#ffcc00"/>
              <stop offset="100%" stop-color="#ff8c00"/>
            </radialGradient>

            <!-- Moon gradient -->
            <radialGradient id="moonGradient" cx="30%" cy="30%">
              <stop offset="0%" stop-color="#f0f0f8"/>
              <stop offset="100%" stop-color="#c0c0d0"/>
            </radialGradient>
          </defs>

          <!-- Angle arc and lines (drawn behind object) -->
          <g id="angle-display">
            <line id="angle-line-top" class="angle-lines" x1="80" y1="150" x2="700" y2="150"/>
            <line id="angle-line-bottom" class="angle-lines" x1="80" y1="150" x2="700" y2="150"/>
            <path id="angle-arc" class="angle-arc" d=""/>
            <text id="angle-text" x="120" y="150" fill="#f4d03f" font-size="14" font-family="var(--font-mono)"></text>
          </g>

          <!-- Observer (eye) -->
          <g id="observer" transform="translate(80, 150)">
            <circle cx="0" cy="0" r="20" fill="#252538" stroke="#5dade2" stroke-width="2"/>
            <circle cx="5" cy="0" r="8" fill="#5dade2"/>
            <circle cx="7" cy="-2" r="2" fill="#fff"/>
            <text x="0" y="35" text-anchor="middle" fill="#a0a0b0" font-size="12">Observer</text>
          </g>

          <!-- Celestial object -->
          <g id="celestial-object">
            <circle id="object-circle" cx="600" cy="150" r="40" fill="url(#sunGradient)" filter="url(#glow)"
                    role="img" aria-label="Sun at 1 AU, angular size 0.53°"/>
          </g>

          <!-- Distance indicator -->
          <g id="distance-indicator">
            <line x1="100" y1="250" x2="600" y2="250" stroke="#606070" stroke-width="1"/>
            <line x1="100" y1="245" x2="100" y2="255" stroke="#606070" stroke-width="1"/>
            <line x1="600" y1="245" x2="600" y2="255" stroke="#606070" stroke-width="1"/>
            <text id="distance-label" x="350" y="270" text-anchor="middle" fill="#a0a0b0" font-size="12"></text>
          </g>

          <!-- Size indicator (on object) -->
          <g id="size-indicator">
            <line id="size-line" x1="600" y1="110" x2="600" y2="190" stroke="#f4d03f" stroke-width="1" stroke-dasharray="4 2"/>
            <text id="size-label" x="620" y="150" fill="#f4d03f" font-size="11"></text>
          </g>
        </svg>
      </div>

      <!-- Readout Panel -->
      <div class="readout-panel">
        <div class="readout-item">
          <div class="readout-label">Angular Size</div>
          <div class="readout-value" id="angular-size-value">0.53</div>
          <div class="readout-unit" id="angular-size-unit">degrees</div>
          <div id="angle-warning" class="angle-warning" style="display:none"></div>
        </div>
        <div class="readout-item">
          <div class="readout-label">Physical Size</div>
          <div class="readout-value" id="size-value">1.39</div>
          <div class="readout-unit" id="size-unit">million km</div>
        </div>
        <div class="readout-item">
          <div class="readout-label">Distance</div>
          <div class="readout-value" id="distance-value">150</div>
          <div class="readout-unit" id="distance-unit">million km</div>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls-grid">
        <div class="control-card">
          <div class="control-title">
            Distance
            <span class="control-value" id="distance-display">150 Mkm</span>
          </div>
          <input type="range" id="distance-slider" class="astro-slider" min="0" max="1000" value="500" aria-label="Distance" data-tooltip-source="#distance-display">
        </div>

        <div class="control-card">
          <div class="control-title">
            Physical Size
            <span class="control-value" id="size-display">1.39 Mkm</span>
          </div>
          <input type="range" id="size-slider" class="astro-slider" min="0" max="1000" value="500" aria-label="Physical Size" data-tooltip-source="#size-display">
        </div>

        <div class="control-card full-width">
          <div class="preset-category">
            <label for="preset-category">Presets</label>
            <select id="preset-category">
              <option value="everyday">Everyday Objects</option>
              <option value="astronomical" selected>Astronomical Objects</option>
            </select>
          </div>

          <div class="presets-section" id="astro-presets-section">
            <div class="presets-label">Astronomical Objects</div>
            <div class="presets-row" id="astro-presets"></div>
          </div>

          <div class="presets-section" id="everyday-presets-section" style="display: none;">
            <div class="presets-label">Everyday Objects</div>
            <div class="presets-row" id="easter-presets"></div>
          </div>

	          <!-- Time Evolution (Moon only) -->
	          <div class="time-control" id="time-control" style="display: none;">
	            <div class="control-title">
	              Moon Time Mode
	              <span class="control-value" id="time-display">Perigee</span>
	            </div>

	            <div class="time-mode-row" role="group" aria-label="Moon time mode">
	              <label class="time-mode-option">
	                <input type="radio" name="moon-time-mode" id="moon-time-mode-orbit" value="orbit" checked>
	                Orbit (perigee ↔ apogee)
	              </label>
	              <label class="time-mode-option">
	                <input type="radio" name="moon-time-mode" id="moon-time-mode-recession" value="recession">
	                Recession (Myr from today)
	              </label>
	            </div>

	            <div id="moon-time-orbit-controls">
	              <input type="range" id="time-slider" class="astro-slider" min="0" max="360" value="0" step="1" aria-label="Moon orbit position (degrees)" data-tooltip-source="#time-display">
	              <div class="time-label">
	                <span>Perigee</span>
	                <span>Apogee</span>
	              </div>
	              <div class="time-range" id="moon-angular-range"></div>
	            </div>

	            <div id="moon-time-recession-controls" style="display: none;">
	              <input type="range" id="recession-slider" class="astro-slider" min="-1000" max="1000" value="0" step="10" aria-label="Moon recession time (million years from today)" data-tooltip-source="#time-display">
	              <div class="time-label">
	                <span>Past</span>
	                <span>Future</span>
	              </div>
	              <div class="time-range" id="moon-recession-note">
	                Toy model: linear extrapolation using today’s mean recession rate (varies over time).
	              </div>
	            </div>
	          </div>
	        </div>
	      </div>

      <div class="model-note">
        <strong>Model note:</strong> Angular size uses the exact angular diameter formula; at very close distances, angles saturate. For visibility, the diagram's rays/object are visually magnified (the numeric readout is the authoritative value). Units may auto-switch (° / ′ / ″). Internal units = km.
      </div>

      <!-- Reference Guide -->
      <div class="reference-guide">
        <strong>Thumb rule:</strong> Your thumb at arm's length covers about <strong>2°</strong> of sky.
        The Sun and Moon each cover about <strong>0.5°</strong> — a quarter of your thumb width!
      </div>

      <!-- Screen reader announcements -->
      <div id="status-announce" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    </div>
  </div>

  <script src="../_assets/astro-utils.js"></script>
  <script src="../_assets/demo-polish.js"></script>
  <script src="../_assets/starfield.js"></script>
  <script src="../_assets/angular-size-model.js"></script>
  <script src="angular-size.js"></script>
</body>
</html>
